# Core Agent

## Setup
```
conda create -n core-agent python=3.12
conda activate core-agent
pip install --upgrade --force-reinstall langchain-core
# install `core_agent` package
conda develop .
```

### GPT models
1. Create an account at https://platform.openai.com/ and add some balance
2. Create a new API key and copy it somewhere: https://platform.openai.com/organization/api-keys
3. Install dependencies and set the appropriate API key:
```
pip install --upgrade --force-reinstall langchain-openai
conda env config vars set OPENAI_API_KEY=<API key>
```

### Llama models

**Local inference via Llama.cpp**

https://github.com/abetlen/llama-cpp-python?tab=readme-ov-file#supported-backends
```
CMAKE_ARGS="-DGGML_CUDA=on -DLLAVA_BUILD=off" pip install llama-cpp-python --upgrade --force-reinstall --no-cache-dir --verbose
```

Note: there are some dependency conflicts between `langchain` and `llama-cpp-python` but these can be ignored.
```
langchain 0.2.9 requires numpy<2.0.0,>=1.26.0; python_version >= "3.12", but you have numpy 2.0.1 which is incompatible.
langchain-community 0.2.7 requires numpy<2.0.0,>=1.26.0; python_version >= "3.12", but you have numpy 2.0.1 which is incompatible.
```

Comment out this block: https://github.com/langchain-ai/langchain/blame/0a2ff40fcc990fdc4e91292c9a70201678bd5fc4/libs/community/langchain_community/chat_models/llamacpp.py#L752
```
if "function_call" in message_dict or "tool_calls" in message_dict:
    message_dict["content"] = message_dict["content"] or None
```

:exclamation: Llama-8b needs at least an A6000 GPU; Llama-70b needs at least an H100 GPU

**Serverless inference via TogetherAI**

- [ ] Add option to run Llama-3.1 without local GPU

## Optional: LangSmith Tracing

1. Get a LangChain API key: https://smith.langchain.com/o/a9224683-813a-40c8-b75a-3bf8f25e73c9/settings/workspaces/apikeys

See also: https://python.langchain.com/v0.1/docs/langsmith/walkthrough/#log-runs-to-langsmith
2. Install dependency and set the appropriate environment variables:
```
pip install --upgrade --force-reinstall langsmith
conda env config vars set LANGCHAIN_TRACING_V2="true"
conda env config vars set LANGCHAIN_API_KEY=<API key>
# Note: the project name will automatically be generated by the prediction script.
```
